#ifndef __J_INCuBATOR_H__
#define __J_INCuBATOR_H__
#include <asm/ioctls.h>
#include <errno.h>
#include <fcntl.h>
#include <math.h>
#include <net/if.h>
#include <netinet/in.h>
#include <pthread.h>
#include <resolv.h>
#include <signal.h>
#include <signal.h>
#include <stdarg.h>
#include <stdlib.h>
#include <string.h>
#include <sys/ipc.h>
#include <sys/shm.h>
#include <sys/socket.h>
#include <sys/stat.h>
#include <sys/mman.h>
#include <sys/types.h>
#include <termios.h>
#include <unistd.h>
#include "md5_file.h"
#include "../zlog/zlog.h"
#include "jshmem.h"
#include "define.h"
#include "serial.h"
#include "job.h"

//----------------------------------------------------------------------------------------------------------
// PT100参数
//----------------------------------------------------------------------------------------------------------
struct pt100_para_t
{
    unsigned short pt_0_temp;
    unsigned short pt_40_temp;
    unsigned short pt_0_channel;
    unsigned short pt_40_channel;
};

//----------------------------------------------------------------------------------------------------------
// INI配置结构体
//----------------------------------------------------------------------------------------------------------
struct incubator_t
{
    char device_id[256];
    char conf_zlog_file[256];
    char conf_sysc_file[256];

    char co2_serial_device[256];
    char motor_serial_device[256];

    int shmem_input_key;
    int shmem_output_key;
    int shmem_record_len;
    int shmem_record_num;

    char db_setting_ip[256];
    char db_setting_user[256];
    char db_setting_passwd[256];
    char db_setting_name[256];

    struct pt100_para_t pt1;
    struct pt100_para_t pt2;
    struct pt100_para_t pt3;
    struct pt100_para_t pt4;
    struct pt100_para_t pt5;
    struct pt100_para_t pt6;
};
//----------------------------------------------------------------------------------------------------------
// 获取参数
//----------------------------------------------------------------------------------------------------------
short get_val(unsigned short index);
short get_old(unsigned short index);
unsigned short get_uval(unsigned short index);
unsigned short get_uold(unsigned short index);
float get_fval(unsigned short index);
double get_dval(unsigned short index);
short get_x10_val(unsigned short index);
short get_e10_val(unsigned short index);
int get_int(unsigned short index);

//----------------------------------------------------------------------------------------------------------
// 设置参数
//----------------------------------------------------------------------------------------------------------
void set_val(unsigned short index, short data);
void set_old(unsigned short index, short data);
void set_uval(unsigned short index, unsigned short data);
void set_uold(unsigned short index, unsigned short data);
void set_fval(unsigned short index, float data);
void set_fold(unsigned short index, float data);
void set_dval(unsigned short index, double data);
void set_dold(unsigned short index, double data);
void mem_val(unsigned short index, void *data, unsigned short len);
void set_int(unsigned short index, int data);

//----------------------------------------------------------------------------------------------------------
// 功能函数
//----------------------------------------------------------------------------------------------------------
// INI文件初始化
//----------------------------------------------------------------------------------------------------------
void init_ini_file(const char *ini_path, struct incubator_t *st_incubator);

//----------------------------------------------------------------------------------------------------------
// ZLOG日志初始化
//----------------------------------------------------------------------------------------------------------
int init_zlog_file(const char *conf_zlog_file, const char *process_name);
//----------------------------------------------------------------------------------------------------------
// 初始化参数
//----------------------------------------------------------------------------------------------------------
void init_para();

//----------------------------------------------------------------------------------------------------------
// 将共享内存写入INI文化中
//----------------------------------------------------------------------------------------------------------
int syn_shm_to_ini(const char *file_name, unsigned short index, int size);

//----------------------------------------------------------------------------------------------------------
// 从INI文件同步数据到共享内存
//----------------------------------------------------------------------------------------------------------
int syn_ini_to_shm(const char *file_name, unsigned short index, int size);

//----------------------------------------------------------------------------------------------------------
// 从共享内存获取当前时间
//----------------------------------------------------------------------------------------------------------
unsigned int get_time(unsigned short addr);
unsigned int get_time_old(unsigned short addr);

//----------------------------------------------------------------------------------------------------------
// 将当前时间保存到共享内存中
//----------------------------------------------------------------------------------------------------------
void set_time(unsigned short addr, unsigned int time);
void set_time_old(unsigned short addr, unsigned int time);

//----------------------------------------------------------------------------------------------------------
// 系统时间函数
//----------------------------------------------------------------------------------------------------------
void run_sys_time();

//----------------------------------------------------------------------------------------------------------
// 更新设置参数
//----------------------------------------------------------------------------------------------------------
void update_set_para();

//----------------------------------------------------------------------------------------------------------
// 预热设置参数
//----------------------------------------------------------------------------------------------------------
void preheat_set_para();

//----------------------------------------------------------------------------------------------------------
// 初始化启动模式
//----------------------------------------------------------------------------------------------------------
void init_start_mode();

//----------------------------------------------------------------------------------------------------------
// 初始化停止模式
//----------------------------------------------------------------------------------------------------------
void init_stop_mode();

//----------------------------------------------------------------------------------------------------------
// 初始化预热模式
//----------------------------------------------------------------------------------------------------------
void init_preheat_mode();

//----------------------------------------------------------------------------------------------------------
// 获取运行模式
//----------------------------------------------------------------------------------------------------------
unsigned short get_run_mode(int type);

//----------------------------------------------------------------------------------------------------------
// 设置运行模式
//----------------------------------------------------------------------------------------------------------
void set_run_mode(unsigned short mode);

//----------------------------------------------------------------------------------------------------------
// 获取测试模式
//----------------------------------------------------------------------------------------------------------
unsigned short get_test_mode();

//----------------------------------------------------------------------------------------------------------
// 设置测试模式
//----------------------------------------------------------------------------------------------------------
void set_test_mode(unsigned short mode);

//----------------------------------------------------------------------------------------------------------
// 测试控制模式
//----------------------------------------------------------------------------------------------------------
void test_control_mode();

//----------------------------------------------------------------------------------------------------------
// LED灯控制函数
//----------------------------------------------------------------------------------------------------------
void direction_func();

//----------------------------------------------------------------------------------------------------------
// 温度预警计算
//----------------------------------------------------------------------------------------------------------
void temp_update_para_data();

//----------------------------------------------------------------------------------------------------------
// PID初始化
//----------------------------------------------------------------------------------------------------------
void pid_temp_init();
void pid_humi_init();

//----------------------------------------------------------------------------------------------------------
// 预设参数初始化
//----------------------------------------------------------------------------------------------------------
void preset_para_init(int mode);

//----------------------------------------------------------------------------------------------------------
// 风门控制函数
//----------------------------------------------------------------------------------------------------------
void damper_control_func();

//----------------------------------------------------------------------------------------------------------
// 逻辑处理线程-主温度
//----------------------------------------------------------------------------------------------------------
void logic_process_temp_func();

//----------------------------------------------------------------------------------------------------------
// 逻辑处理线程-湿度
//----------------------------------------------------------------------------------------------------------
void logic_process_humi_func();

//----------------------------------------------------------------------------------------------------------
// 逻辑处理线程-回流温度1-正常模式
//----------------------------------------------------------------------------------------------------------
void normal_logic_process_retemp1_func();

//----------------------------------------------------------------------------------------------------------
// 逻辑处理线程-回流温度2-正常模式
//----------------------------------------------------------------------------------------------------------
void normal_logic_process_retemp2_func();

//----------------------------------------------------------------------------------------------------------
// 逻辑处理线程-回流温度3-正常模式
//----------------------------------------------------------------------------------------------------------
void normal_logic_process_retemp3_func();

//----------------------------------------------------------------------------------------------------------
// 逻辑处理线程-回流温度4-正常模式
//----------------------------------------------------------------------------------------------------------
void normal_logic_process_retemp4_func();

//----------------------------------------------------------------------------------------------------------
// 逻辑处理线程-回流温度1-预热模式
//----------------------------------------------------------------------------------------------------------
void pre_logic_process_retemp1_func();

//----------------------------------------------------------------------------------------------------------
// 逻辑处理线程-回流温度2-预热模式
//----------------------------------------------------------------------------------------------------------
void pre_logic_process_retemp2_func();

//----------------------------------------------------------------------------------------------------------
// 逻辑处理线程-回流温度3-预热模式
//----------------------------------------------------------------------------------------------------------
void pre_logic_process_retemp3_func();

//----------------------------------------------------------------------------------------------------------
// 逻辑处理线程-回流温度4-预热模式
//----------------------------------------------------------------------------------------------------------
void pre_logic_process_retemp4_func();

//----------------------------------------------------------------------------------------------------------
// 控制函数
//----------------------------------------------------------------------------------------------------------
// 运行灯控制
//----------------------------------------------------------------------------------------------------------
void control_run_light(int status);

//----------------------------------------------------------------------------------------------------------
// 报警灯控制
//----------------------------------------------------------------------------------------------------------
void control_warn_light(int status);

//----------------------------------------------------------------------------------------------------------
// 响铃控制
//----------------------------------------------------------------------------------------------------------
void control_electric_light(int status);

//----------------------------------------------------------------------------------------------------------
// 主加热控制
//----------------------------------------------------------------------------------------------------------
void control_main_heat(int status);

//----------------------------------------------------------------------------------------------------------
// 辅助加热控制
//----------------------------------------------------------------------------------------------------------
void control_aux_heat(int status);

//----------------------------------------------------------------------------------------------------------
// 风机运行控制
//----------------------------------------------------------------------------------------------------------
void control_fan(int status);

//----------------------------------------------------------------------------------------------------------
// 水冷电磁阀2-1
//----------------------------------------------------------------------------------------------------------
void control_cool2_1(int status);

//----------------------------------------------------------------------------------------------------------
// 水冷电磁阀2-2
//----------------------------------------------------------------------------------------------------------
void control_cool2_2(int status);

//----------------------------------------------------------------------------------------------------------
// 水冷电磁阀2-3
//----------------------------------------------------------------------------------------------------------
void control_cool2_3(int status);

//----------------------------------------------------------------------------------------------------------
// 水冷电磁阀2-4
//----------------------------------------------------------------------------------------------------------
void control_cool2_4(int status);

//----------------------------------------------------------------------------------------------------------
// 水冷电磁阀2
//----------------------------------------------------------------------------------------------------------
void control_cool2(int type, int status);

//----------------------------------------------------------------------------------------------------------
// 冷热水电磁阀
//----------------------------------------------------------------------------------------------------------
void control_cold_hot_water(int status);

//----------------------------------------------------------------------------------------------------------
// 鼓风机
//----------------------------------------------------------------------------------------------------------
void control_blower(int status);

//----------------------------------------------------------------------------------------------------------
// 风门开控制
//----------------------------------------------------------------------------------------------------------
void control_open_damper(int status);

//----------------------------------------------------------------------------------------------------------
// 风门关控制
//----------------------------------------------------------------------------------------------------------
void control_close_damper(int status, int schedule);

//----------------------------------------------------------------------------------------------------------
// 风门控制
//----------------------------------------------------------------------------------------------------------
void control_damper(int type, int status, int schedule);

//----------------------------------------------------------------------------------------------------------
// 水冷控制
//----------------------------------------------------------------------------------------------------------
void control_cool(int status);

//----------------------------------------------------------------------------------------------------------
// 加湿电磁阀控制
//----------------------------------------------------------------------------------------------------------
void control_spray(int status);

//----------------------------------------------------------------------------------------------------------
// 翻蛋控制
//----------------------------------------------------------------------------------------------------------
void control_egg();

//----------------------------------------------------------------------------------------------------------
// 定时器
//----------------------------------------------------------------------------------------------------------
void timer_callback_func(int signo);

//----------------------------------------------------------------------------------------------------------
// 线程函数
//----------------------------------------------------------------------------------------------------------
// 线程 备份线程
//----------------------------------------------------------------------------------------------------------
void *sysn_thread_func(void *pv);

//----------------------------------------------------------------------------------------------------------
// 数据采集线程-PT100
//----------------------------------------------------------------------------------------------------------
void *data_collection_pt100_func(void *pv);

//----------------------------------------------------------------------------------------------------------
// 数据采集线程-CO2
//----------------------------------------------------------------------------------------------------------
void *data_collection_co2_func(void *pv);

//----------------------------------------------------------------------------------------------------------
// 翻蛋线程
//----------------------------------------------------------------------------------------------------------
void *flip_egg_func(void *pv);

//----------------------------------------------------------------------------------------------------------
// 报警线程
//----------------------------------------------------------------------------------------------------------
void *thread_alarm_func(void *pv);

//----------------------------------------------------------------------------------------------------------
// PID线程
//----------------------------------------------------------------------------------------------------------
// void *thread_pid_func(void *pv);

//----------------------------------------------------------------------------------------------------------
// 主线程
//----------------------------------------------------------------------------------------------------------
void *thread_main_func(void *pv);

#endif //__J_INCuBATOR_H__